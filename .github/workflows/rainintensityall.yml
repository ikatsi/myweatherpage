name: rainintensityall

on:
  workflow_dispatch:

permissions:
  contents: read

jobs:
  run:
    runs-on: ubuntu-24.04

    env:
      TZ: Europe/Athens

      # FTP secrets (already present in your log)
      FTP_HOST: ${{ secrets.FTP_HOST }}
      FTP_USER: ${{ secrets.FTP_USER }}
      FTP_PASS: ${{ secrets.FTP_PASS }}

      # Feed URL(s) used by rainintensityall.py
      CURRENTWEATHER_URL: ${{ secrets.CURRENTWEATHER_URL }}
      TXT_URL: ${{ secrets.TXT_URL }}

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.13"
          cache: pip

      - name: System dependencies (GDAL/PROJ/GEOS)
        run: |
          sudo apt-get update
          sudo apt-get install -y \
            build-essential \
            gdal-bin libgdal-dev \
            proj-bin libproj-dev \
            libgeos-dev \
            python3-dev

      - name: Install Python dependencies
        run: |
          python -m pip install --upgrade pip
          python -m pip install -r requirements.txt

      # If you have encrypted assets in other workflows, this is the place to add
      # the same decrypt/unzip steps. For now we keep it off like your current run.
      - name: Run rainintensityall.py
        run: |
          python rainintensityall.py
