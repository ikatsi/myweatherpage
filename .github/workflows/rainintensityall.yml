name: rainintensityall

on:
  workflow_dispatch:

permissions:
  contents: read

concurrency:
  group: rainintensityall-${{ github.ref }}
  cancel-in-progress: true

jobs:
  run:
    runs-on: ubuntu-24.04
    env:
      TZ: Europe/Athens

      # --- Weather feed URL (this is what you're missing) ---
      # If you stored it as a Secret:
      CURRENTWEATHER_URL: ${{ secrets.CURRENTWEATHER_URL }}
      # If instead you stored it as a Repository Variable, use this line instead:
      # CURRENTWEATHER_URL: ${{ vars.CURRENTWEATHER_URL }}

      # --- FTP creds ---
      FTP_HOST: ${{ secrets.FTP_HOST }}
      FTP_USER: ${{ secrets.FTP_USER }}
      FTP_PASS: ${{ secrets.FTP_PASS }}

      # --- If your script decrypts assets, keep names consistent with the script ---
      # e.g. if rainintensityall.py expects GEOJSON_PASS / ASSETS_PASS, set the right one:
      GEOJSON_PASS: ${{ secrets.GEOJSON_PASS }}
      # ASSETS_PASS: ${{ secrets.ASSETS_PASS }}

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.13"
          cache: "pip"

      - name: System deps (GDAL stack)
        run: |
          sudo apt-get update
          sudo apt-get install -y gdal-bin libgdal-dev

      - name: Install Python deps
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Run script
        run: |
          set -euo pipefail
          python rainintensityall.py
